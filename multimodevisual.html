<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Generative Dot Playground</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
  <style>
    body { margin: 0; overflow: hidden; background: #000; color: white; font-family: sans-serif; }
    #ui {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0, 0, 0, 0.7);
      padding: 10px;
      border-radius: 8px;
      cursor: move;
    }
    select, label, input, button {
      display: block;
      margin-bottom: 6px;
      font-size: 14px;
    }
    button {
      margin-top: 10px;
      padding: 5px 10px;
    }
  </style>
</head>
<body>
  <div id="ui">
    <label for="modeSelect">Mode</label>
    <select id="modeSelect">
      <option value="dotwave">Dot Wave</option>
    </select>

    <label>Grid Size</label>
    <input type="range" id="gridSize" min="10" max="80" value="40"/>

    <label>Amplitude</label>
    <input type="range" id="amplitude" min="1" max="100" value="40"/>

    <label>Frequency</label>
    <input type="range" id="frequency" min="0.01" max="0.1" step="0.005" value="0.03"/>

    <label>Dot Size</label>
    <input type="range" id="dotSize" min="1" max="8" value="3"/>

    <label>Dot Color</label>
    <input type="color" id="dotColor" value="#ffffff"/>

    <label>Background</label>
    <input type="color" id="bgColor" value="#000000"/>

    <button onclick="saveCanvas('dot_visual', 'png')">Export PNG</button>
  </div>

  <script>
    let cols, rows;
    let mode = 'dotwave';

    function setup() {
      createCanvas(windowWidth, windowHeight);
      noStroke();
      dragElement(document.getElementById("ui"));
    }

    function draw() {
      let bg = document.getElementById("bgColor").value;
      background(bg);
      if (mode === 'dotwave') drawDotWave();
    }

    function drawDotWave() {
      let grid = parseInt(document.getElementById('gridSize').value);
      let amp = parseFloat(document.getElementById('amplitude').value);
      let freq = parseFloat(document.getElementById('frequency').value);
      let dotSize = parseFloat(document.getElementById('dotSize').value);
      let dotColor = document.getElementById('dotColor').value;

      cols = grid;
      rows = grid;
      let spacingX = width / cols;
      let spacingY = height / rows;

      fill(dotColor);
      for (let y = 0; y < rows; y++) {
        for (let x = 0; x < cols; x++) {
          let time = millis() * 0.001;
          let offset = sin((x + time * 40) * freq) + cos((y + time * 40) * freq);
          let px = x * spacingX + offset * amp;
          let py = y * spacingY + offset * amp * 0.5;
          circle(px, py, dotSize);
        }
      }
    }

    document.getElementById('modeSelect').addEventListener('change', (e) => {
      mode = e.target.value;
    });

    function windowResized() {
      resizeCanvas(windowWidth, windowHeight);
    }

    // Drag UI Panel
    function dragElement(elmnt) {
      let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
      elmnt.onmousedown = dragMouseDown;

      function dragMouseDown(e) {
        e.preventDefault();
        pos3 = e.clientX;
        pos4 = e.clientY;
        document.onmouseup = closeDragElement;
        document.onmousemove = elementDrag;
      }

      function elementDrag(e) {
        e.preventDefault();
        pos1 = pos3 - e.clientX;
        pos2 = pos4 - e.clientY;
        pos3 = e.clientX;
        pos4 = e.clientY;
        elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
        elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
      }

      function closeDragElement() {
        document.onmouseup = null;
        document.onmousemove = null;
      }
    }
  </script>
</body>
</html>
